# configuration for "master" branch
-
  branches:
    only:
      - master

  image:
   - Visual Studio 2017
  before_build:
   - nuget restore -Verbosity quiet
  dotnet_csproj:
   patch: true
   file: '**\SmtpServerStub.csproj'
   version: '{version}'
   package_version: '{version}'
   assembly_version: '{version}'
   file_version: '{version}'
   informational_version: '{version}'
  build_script:
   - msbuild SmtpServerStub\SmtpServerStub.csproj /v:q /p:Configuration=Release
   - msbuild SmtpServerStubUnitTests\SmtpServerStubUnitTests.csproj /v:q /p:Configuration=Release
  test:
   assemblies:
    - '**\SmtpServerStubUnitTests.dll'
  after_test:
   - ps: |
       $env:PATH = 'C:\msys64\usr\bin;' + $env:PATH
       Invoke-WebRequest -Uri 'https://codecov.io/bash' -OutFile codecov.sh
       bash codecov.sh -f "TestResult.xml" -t 675a48a6-4a27-44a5-b311-8b1ef26fd4b7
  artifacts:
   - path: '**\SmtpServerStub.*.nupkg'
  deploy:
   provider: NuGet
   api_key:
    secure: QCRp8iRF7MVtmNv8X30viZhWIKNWsKfcLEczXKONoDthMbAs0rZK7CiMhCQSa5P/
   skip_symbols: false
   artifact: /.*\.nupkg/

# configuration for development branches
-
  branches:
    except:
      - master

  image:
   - Visual Studio 2017
  before_build:
   - nuget restore -Verbosity quiet
  dotnet_csproj:
   patch: true
   file: '**\SmtpServerStub.csproj'
   version: '{version}'
   package_version: '{version}-{branch}'
   assembly_version: '{version}'
   file_version: '{version}'
   informational_version: '{version}'
  build_script:
   - msbuild SmtpServerStub\SmtpServerStub.csproj /v:q
   - msbuild SmtpServerStubUnitTests\SmtpServerStubUnitTests.csproj /v:q
  test:
   assemblies:
    - '**\SmtpServerStubUnitTests.dll'
  after_test:
   - ps: |
       $env:PATH = 'C:\msys64\usr\bin;' + $env:PATH
       Invoke-WebRequest -Uri 'https://codecov.io/bash' -OutFile codecov.sh
       bash codecov.sh -f "ohoho.xml" -t 675a48a6-4a27-44a5-b311-8b1ef26fd4b7
  artifacts:
   - path: '**\SmtpServerStub.*.nupkg'
  deploy:
   provider: NuGet
   on:
    branch: development
   api_key:
    secure: QCRp8iRF7MVtmNv8X30viZhWIKNWsKfcLEczXKONoDthMbAs0rZK7CiMhCQSa5P/
   skip_symbols: false
   artifact: /.*\.nupkg/